<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Python Playground (Year 9)</title>

  <!-- Pyodide (Python in the browser) -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

  <style>
    :root{
      --bg:#070b16;
      --panel:#0c1430;
      --panel2:#0a1026;
      --text:#d6ecff;
      --muted:#93b6d3;
      --cyan:#00f3ff;
      --amber:#ffae00;
      --green:#00ff7a;
      --red:#ff2b6a;
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Courier New", monospace;
      --ui: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    body{
      margin:0;
      background:
        radial-gradient(900px 600px at 15% 10%, rgba(0,243,255,0.18), transparent 55%),
        radial-gradient(900px 700px at 85% 20%, rgba(255,174,0,0.12), transparent 60%),
        linear-gradient(180deg, #050816 0%, var(--bg) 60%, #050816 100%);
      color:var(--text);
      font-family:var(--ui);
      padding:18px;
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap:14px;
    }

    .card{
      background:linear-gradient(180deg, rgba(12,20,48,0.92), rgba(10,16,38,0.92));
      border:1px solid rgba(0,243,255,0.18);
      border-radius:var(--radius);
      box-shadow: 0 10px 28px rgba(0,0,0,0.35);
      overflow:hidden;
    }

    .head{
      padding:14px 16px;
      border-bottom:1px solid rgba(0,243,255,0.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    h1{
      margin:0;
      font-size:16px;
      letter-spacing:0.6px;
      font-weight:800;
    }

    .sub{
      margin:0;
      font-size:12px;
      color:var(--muted);
    }

    .badge{
      font-family:var(--mono);
      font-size:11px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(0,243,255,0.12);
      border:1px solid rgba(0,243,255,0.18);
      color:var(--text);
      white-space:nowrap;
    }

    .body{
      padding:14px 16px 16px;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:12px;
    }

    select, button{
      border-radius:12px;
      border:1px solid rgba(0,243,255,0.18);
      background:rgba(8,14,30,0.7);
      color:var(--text);
      padding:10px 12px;
      font-weight:700;
      cursor:pointer;
    }

    button{
      transition: transform 0.05s ease, background 0.2s ease, border-color 0.2s ease;
    }
    button:active{ transform: translateY(1px); }

    .btn-run{ border-color: rgba(0,255,122,0.35); background: rgba(0,255,122,0.10); }
    .btn-run:hover{ background: rgba(0,255,122,0.16); }

    .btn-warn{ border-color: rgba(255,174,0,0.35); background: rgba(255,174,0,0.10); }
    .btn-warn:hover{ background: rgba(255,174,0,0.16); }

    .btn-danger{ border-color: rgba(255,43,106,0.35); background: rgba(255,43,106,0.10); }
    .btn-danger:hover{ background: rgba(255,43,106,0.16); }

    .btn-ghost{
      border-color: rgba(0,243,255,0.18);
      background: rgba(0,243,255,0.06);
    }
    .btn-ghost:hover{ background: rgba(0,243,255,0.10); }

    textarea{
      width:100%;
      min-height:360px;
      resize:vertical;
      border-radius:14px;
      border:1px solid rgba(0,243,255,0.18);
      background:rgba(6,10,22,0.75);
      color:var(--text);
      padding:12px;
      font-family:var(--mono);
      font-size:13px;
      line-height:1.45;
      outline:none;
    }

    .mission{
      background:rgba(0,243,255,0.06);
      border:1px solid rgba(0,243,255,0.14);
      border-radius:14px;
      padding:12px;
      margin-bottom:12px;
    }
    .mission h2{
      margin:0 0 8px 0;
      font-size:13px;
      letter-spacing:0.4px;
    }
    .mission p{
      margin:0;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.35;
    }

    .console{
      background:rgba(0,0,0,0.35);
      border:1px solid rgba(0,243,255,0.14);
      border-radius:14px;
      padding:12px;
      font-family:var(--mono);
      font-size:12.5px;
      min-height:240px;
      white-space:pre-wrap;
      overflow:auto;
    }

    .status{
      font-family:var(--mono);
      font-size:11px;
      color:var(--muted);
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .tip{
      color:var(--muted);
      font-size:12px;
      margin-top:10px;
      line-height:1.35;
    }

    .glow{
      color:var(--cyan);
      text-shadow: 0 0 12px rgba(0,243,255,0.35);
    }

    @media (max-width: 980px){
      .wrap{ grid-template-columns:1fr; }
      textarea{ min-height:320px; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- LEFT: CODE -->
    <div class="card">
      <div class="head">
        <div class="title">
          <h1>Python Playground <span class="glow">Year 9</span> üêç</h1>
          <p class="sub">Pick a mission, code it, run it. Your edits are yours only.</p>
        </div>
        <div class="badge" id="pyStatus">Loading Python‚Ä¶</div>
      </div>

      <div class="body">
        <div class="row">
          <label style="font-size:12px;color:var(--muted);font-weight:700">Mission pack:</label>
          <select id="pack">
            <option value="all">All Missions</option>
            <option value="print">Print / Output</option>
            <option value="input">Input</option>
            <option value="vars">Variables</option>
            <option value="if">If / Else / Elif</option>
            <option value="for">For Loops</option>
            <option value="while">While Loops</option>
            <option value="lists">Lists</option>
            <option value="func">Functions</option>
          </select>

          <button class="btn-ghost" id="btnRandom">üé≤ Random mission</button>
          <button class="btn-warn" id="btnReset">‚Ü© Reset code</button>
        </div>

        <div class="mission">
          <h2 id="missionTitle">Mission: Loading‚Ä¶</h2>
          <p id="missionDesc">Stand by. Python is putting on its shoes.</p>
        </div>

        <textarea id="code" spellcheck="false"></textarea>

        <div class="row" style="margin-top:12px">
          <button class="btn-run" id="btnRun">‚ñ∂ Run</button>
          <button class="btn-ghost" id="btnClear">üßº Clear output</button>
          <button class="btn-danger" id="btnHardReset" title="If you get stuck in an infinite loop, this is your escape hatch.">üßØ Panic Reload</button>
        </div>

        <div class="tip">
          Tip: If your code asks for <b>input()</b>, the sandbox will pop up a little question box.
          If you accidentally create an infinite loop, hit <b>Panic Reload</b> üßØ
        </div>

        <div class="status">
          <div>Autosave: <span id="saveStatus">off</span></div>
          <div>Sandbox: <span class="glow">per-student (browser local)</span></div>
        </div>
      </div>
    </div>

    <!-- RIGHT: OUTPUT -->
    <div class="card">
      <div class="head">
        <div class="title">
          <h1>Console Output üí¨</h1>
          <p class="sub">print() and errors appear here.</p>
        </div>
        <div class="badge">stdout / stderr</div>
      </div>

      <div class="body">
        <div id="console" class="console">Loading‚Ä¶</div>
        <div class="tip">
          Challenge yourself: can you make your output match exactly what the mission asks for?
          Computers are very picky housecats üêà
        </div>
      </div>
    </div>

  </div>

<script>
  // ---------- Missions (Year 9 friendly) ----------
  const MISSIONS = [
    // PRINT / OUTPUT
    {
      id:"p1", pack:"print",
      title:"Print a greeting",
      desc:"Make the program output: Hello, Year 9!",
      starter:`print("Hello, Year 9!")\n`
    },
    {
      id:"p2", pack:"print",
      title:"Two lines of output",
      desc:"Output two lines: Line 1 then Line 2.",
      starter:`print("Line 1")\nprint("Line 2")\n`
    },

    // INPUT
    {
      id:"i1", pack:"input",
      title:"Ask a name",
      desc:"Ask for a name, then output: Welcome, NAME",
      starter:`name = input("Enter your name: ")\nprint("Welcome,", name)\n`
    },

    // VARIABLES
    {
      id:"v1", pack:"vars",
      title:"Variables: points",
      desc:"Make a variable called points with value 10, then print it.",
      starter:`points = 10\nprint(points)\n`
    },
    {
      id:"v2", pack:"vars",
      title:"Variables + maths",
      desc:"Ask for a number, store it, then print the number times 2.",
      starter:`n = int(input("Enter a number: "))\nprint(n * 2)\n`
    },

    // IF / ELSE / ELIF
    {
      id:"if1", pack:"if",
      title:"Odd or even (starter)",
      desc:"Ask for an integer. If it is even, print EVEN, otherwise print ODD.",
      starter:`n = int(input("Enter an integer: "))\n# Your if/else here\n`
    },
    {
      id:"if2", pack:"if",
      title:"Grade check (elif)",
      desc:"Ask for a mark (0-100). Print: A (80+), B (70-79), C (60-69), D (50-59), F (below 50).",
      starter:`mark = int(input("Enter mark (0-100): "))\n# Use if / elif / else\n`
    },

    // FOR LOOPS
    {
      id:"f1", pack:"for",
      title:"Countdown with a for loop",
      desc:"Print 5, 4, 3, 2, 1 on separate lines.",
      starter:`for i in range(5, 0, -1):\n    print(i)\n`
    },
    {
      id:"f2", pack:"for",
      title:"Total from 1 to 10",
      desc:"Use a for loop to add up numbers 1 to 10 and print the total.",
      starter:`total = 0\nfor i in range(1, 11):\n    # add i to total\n\nprint(total)\n`
    },

    // WHILE LOOPS
    {
      id:"w1", pack:"while",
      title:"Password gate",
      desc:"Keep asking for a password until they type 'python'. Then print ACCESS GRANTED.",
      starter:`pw = input("Password: ")\nwhile pw != "python":\n    pw = input("Password: ")\n\nprint("ACCESS GRANTED")\n`
    },

    // LISTS
    {
      id:"l1", pack:"lists",
      title:"List basics",
      desc:"Create a list: [3, 7, 2]. Print the first element, then the last element.",
      starter:`nums = [3, 7, 2]\n# Print first element\n# Print last element\n`
    },
    {
      id:"l2", pack:"lists",
      title:"Sum a list",
      desc:"Given a list of numbers, calculate the sum and print it.",
      starter:`nums = [5, 1, 9, 2]\n# Calculate sum using a loop\n`
    },

    // FUNCTIONS
    {
      id:"fn1", pack:"func",
      title:"Function: square",
      desc:"Write a function square(n) that returns n*n. Then print square(6).",
      starter:`def square(n):\n    # return n squared\n\nprint(square(6))\n`
    },
    {
      id:"fn2", pack:"func",
      title:"Function: greeting",
      desc:"Write a function greet(name) that prints: Hello, NAME! Then call it with 'Aisha'.",
      starter:`def greet(name):\n    # print a greeting\n\ngreet("Aisha")\n`
    }
  ];

  // ---------- UI elements ----------
  const elPack = document.getElementById("pack");
  const elTitle = document.getElementById("missionTitle");
  const elDesc  = document.getElementById("missionDesc");
  const elCode  = document.getElementById("code");
  const elConsole = document.getElementById("console");
  const elPyStatus = document.getElementById("pyStatus");
  const elSaveStatus = document.getElementById("saveStatus");

  const btnRandom = document.getElementById("btnRandom");
  const btnReset  = document.getElementById("btnReset");
  const btnRun    = document.getElementById("btnRun");
  const btnClear  = document.getElementById("btnClear");
  const btnHardReset = document.getElementById("btnHardReset");

  const STORAGE_KEY = "year9_py_sandbox_code_v1";
  const STORAGE_MISSION = "year9_py_sandbox_mission_v1";

  let pyodideReady = null;
  let currentMission = null;

  function setConsole(text){
    elConsole.textContent = text;
    elConsole.scrollTop = elConsole.scrollHeight;
  }

  function appendConsole(text){
    elConsole.textContent += text;
    elConsole.scrollTop = elConsole.scrollHeight;
  }

  function filteredMissions(){
    const pack = elPack.value;
    if(pack === "all") return MISSIONS;
    return MISSIONS.filter(m => m.pack === pack);
  }

  function pickRandomMission(){
    const list = filteredMissions();
    return list[Math.floor(Math.random() * list.length)];
  }

  function loadMission(m, overwriteCode=true){
    currentMission = m;
    elTitle.textContent = "Mission: " + m.title;
    elDesc.textContent = m.desc;

    if(overwriteCode){
      elCode.value = m.starter;
    }

    localStorage.setItem(STORAGE_MISSION, m.id);
    saveCode();
  }

  function saveCode(){
    localStorage.setItem(STORAGE_KEY, elCode.value);
    elSaveStatus.textContent = "saved ‚úì";
    setTimeout(() => elSaveStatus.textContent = "saved", 900);
  }

  function restoreCode(){
    const saved = localStorage.getItem(STORAGE_KEY);
    if(saved !== null){
      elCode.value = saved;
      elSaveStatus.textContent = "restored ‚úì";
      setTimeout(() => elSaveStatus.textContent = "saved", 900);
      return true;
    }
    return false;
  }

  function restoreMission(){
    const id = localStorage.getItem(STORAGE_MISSION);
    if(!id) return null;
    return MISSIONS.find(m => m.id === id) || null;
  }

  // Autosave as they type (lightweight)
  let saveTimer = null;
  elCode.addEventListener("input", () => {
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(saveCode, 250);
  });

  elPack.addEventListener("change", () => {
    loadMission(pickRandomMission(), true);
  });

  btnRandom.addEventListener("click", () => loadMission(pickRandomMission(), true));
  btnReset.addEventListener("click", () => {
    if(!currentMission) return;
    elCode.value = currentMission.starter;
    saveCode();
  });

  btnClear.addEventListener("click", () => setConsole(""));

  btnHardReset.addEventListener("click", () => {
    // Escape hatch for infinite loops: reload the iframe/page.
    location.reload();
  });

  // ---------- Python runtime ----------
  async function bootPyodide(){
    elPyStatus.textContent = "Loading Python‚Ä¶";
    pyodideReady = loadPyodide();
    const py = await pyodideReady;

    // Wire Python stdout/stderr to our console.
    py.setStdout({ batched: (s) => appendConsole(s) });
    py.setStderr({ batched: (s) => appendConsole(s) });

    // Provide a friendly input() using browser prompt.
    py.globals.set("js_input", (msg) => {
      const ans = prompt(msg || "Input:");
      return ans === null ? "" : ans;
    });

    // Patch input() in Python to call js_input
    await py.runPythonAsync(`
import builtins
def _patched_input(prompt=""):
    return js_input(prompt)
builtins.input = _patched_input
`);

    elPyStatus.textContent = "Python ready ‚úì";
    return py;
  }

  btnRun.addEventListener("click", async () => {
    setConsole(""); // clear each run
    appendConsole("‚ñ∂ Running‚Ä¶\n\n");

    try{
      const py = await pyodideReady;

      // Wrap user code so we can show a nicer traceback label
      const userCode = elCode.value;

      // A tiny safety note: true infinite loops can freeze the tab.
      // Students can hit Panic Reload if needed.
      await py.runPythonAsync(userCode);

      appendConsole("\n\n‚úÖ Done.");
    }catch(err){
      appendConsole("\n\n‚ùå Error:\n" + err);
    }
  });

  // ---------- Start ----------
  (async function init(){
    setConsole("Loading Python‚Ä¶");

    // choose mission: restore last mission if possible
    let m = restoreMission() || pickRandomMission();
    loadMission(m, true);

    // restore student code (if they had one)
    const hadSaved = restoreCode();
    if(!hadSaved){
      elSaveStatus.textContent = "saved";
    }else{
      elSaveStatus.textContent = "saved";
    }

    // boot python
    await bootPyodide();
    setConsole("Python ready. Pick a mission and hit Run! üêç\n");
  })();
</script>

</body>
</html>
