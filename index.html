<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Python Sandbox</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
  <style>
    :root{
      --bg:#070b16; --panel:#0c1430; --text:#d6ecff; --muted:#93b6d3;
      --cyan:#00f3ff; --green:#00ff7a; --red:#ff2b6a;
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Courier New", monospace;
      --ui: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      --radius:16px;
    }
    body{
      margin:0; padding:18px; color:var(--text); font-family:var(--ui);
      background: radial-gradient(900px 600px at 15% 10%, rgba(0,243,255,0.16), transparent 55%),
                  linear-gradient(180deg, #050816 0%, var(--bg) 70%, #050816 100%);
    }
    .wrap{ max-width:1100px; margin:0 auto; display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    .card{
      background:rgba(12,20,48,0.9);
      border:1px solid rgba(0,243,255,0.18);
      border-radius:var(--radius);
      box-shadow:0 10px 28px rgba(0,0,0,0.35);
      overflow:hidden;
    }
    .head{ padding:12px 14px; border-bottom:1px solid rgba(0,243,255,0.12); display:flex; justify-content:space-between; align-items:center; gap:10px; }
    h1{ margin:0; font-size:14px; letter-spacing:0.5px; }
    .badge{ font-family:var(--mono); font-size:11px; padding:6px 10px; border-radius:999px;
            background:rgba(0,243,255,0.12); border:1px solid rgba(0,243,255,0.18); }
    .body{ padding:12px 14px 14px; }
    textarea{
      width:100%; min-height:420px; resize:vertical; outline:none;
      border-radius:14px; border:1px solid rgba(0,243,255,0.18);
      background:rgba(6,10,22,0.75); color:var(--text);
      padding:12px; font-family:var(--mono); font-size:13px; line-height:1.45;
    }
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    button{
      border-radius:12px; border:1px solid rgba(0,243,255,0.18);
      background:rgba(8,14,30,0.7); color:var(--text);
      padding:10px 12px; font-weight:700; cursor:pointer;
    }
    .btn-run{ border-color:rgba(0,255,122,0.35); background:rgba(0,255,122,0.10); }
    .btn-run:hover{ background:rgba(0,255,122,0.16); }
    .btn-clear{ background:rgba(0,243,255,0.06); }
    .btn-danger{ border-color:rgba(255,43,106,0.35); background:rgba(255,43,106,0.10); }
    .btn-danger:hover{ background:rgba(255,43,106,0.16); }
    .console{
      background:rgba(0,0,0,0.35);
      border:1px solid rgba(0,243,255,0.14);
      border-radius:14px;
      padding:12px;
      font-family:var(--mono);
      font-size:12.5px;
      min-height:420px;
      white-space:pre-wrap;
      overflow:auto;
    }
    .note{ margin-top:10px; color:var(--muted); font-size:12px; line-height:1.35; }
    @media (max-width: 980px){ .wrap{ grid-template-columns:1fr; } }
  </style>
</head>
<body>

<div class="wrap">
  <div class="card">
    <div class="head">
      <h1>Python Sandbox üêç</h1>
      <div class="badge" id="status">Loading Python‚Ä¶</div>
    </div>
    <div class="body">
      <textarea id="code" spellcheck="false">print("Hello!")</textarea>
      <div class="row">
        <button class="btn-run" id="run">‚ñ∂ Run</button>
        <button class="btn-clear" id="clearOut">üßº Clear output</button>
        <button class="btn-clear" id="save">üíæ Save</button>
        <button class="btn-clear" id="load">üì• Load</button>
        <button class="btn-danger" id="panic" title="If your code freezes the page (infinite loop), reload everything.">üßØ Panic reload</button>
      </div>
      <div class="note">
        <b>input()</b> will pop up a small question box.  
        Save/Load stores code only in <b>this browser</b> (not shared with anyone).
      </div>
    </div>
  </div>

  <div class="card">
    <div class="head">
      <h1>Output üí¨</h1>
      <div class="badge">stdout / stderr</div>
    </div>
    <div class="body">
      <div id="console" class="console">Loading‚Ä¶</div>
    </div>
  </div>
</div>

<script>
  const codeEl = document.getElementById("code");
  const consoleEl = document.getElementById("console");
  const statusEl = document.getElementById("status");

  const STORAGE_KEY = "py_sandbox_code_v1";
  let pyodideReady = null;

  function setConsole(text){
    consoleEl.textContent = text;
    consoleEl.scrollTop = consoleEl.scrollHeight;
  }
  function appendConsole(text){
    consoleEl.textContent += text;
    consoleEl.scrollTop = consoleEl.scrollHeight;
  }

  async function boot(){
    setConsole("Loading Python‚Ä¶");
    statusEl.textContent = "Loading Python‚Ä¶";

    pyodideReady = loadPyodide();
    const py = await pyodideReady;

    // Hook stdout / stderr
    py.setStdout({ batched: (s) => appendConsole(s) });
    py.setStderr({ batched: (s) => appendConsole(s) });

    // Friendly input() via prompt
    py.globals.set("js_input", (msg) => {
      const ans = prompt(msg || "Input:");
      return ans === null ? "" : ans;
    });

    await py.runPythonAsync(`
import builtins
def _patched_input(prompt=""):
    return js_input(prompt)
builtins.input = _patched_input
`);

    statusEl.textContent = "Python ready ‚úì";
    setConsole("Python ready. Type code and press Run! üêç\n");
  }

  document.getElementById("run").addEventListener("click", async () => {
    setConsole("‚ñ∂ Running‚Ä¶\n\n");
    try{
      const py = await pyodideReady;
      await py.runPythonAsync(codeEl.value);
      appendConsole("\n\n‚úÖ Done.");
    }catch(err){
      appendConsole("\n\n‚ùå Error:\n" + err);
    }
  });

  document.getElementById("clearOut").addEventListener("click", () => setConsole(""));

  document.getElementById("save").addEventListener("click", () => {
    localStorage.setItem(STORAGE_KEY, codeEl.value);
    statusEl.textContent = "Saved ‚úì";
    setTimeout(() => statusEl.textContent = "Python ready ‚úì", 900);
  });

  document.getElementById("load").addEventListener("click", () => {
    const saved = localStorage.getItem(STORAGE_KEY);
    if(saved !== null) codeEl.value = saved;
    statusEl.textContent = saved ? "Loaded ‚úì" : "Nothing saved";
    setTimeout(() => statusEl.textContent = "Python ready ‚úì", 900);
  });

  document.getElementById("panic").addEventListener("click", () => location.reload());

  boot();
</script>

</body>
</html>
