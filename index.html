<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Python Sandbox</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

  <style>
    :root{
      --bg:#050a14;
      --panel:#0a1122;
      --panel2:#081022;
      --text:#d6ecff;
      --muted:#8fb7d7;

      --cyan:#00f3ff;
      --amber:#ffae00;
      --green:#00ff7a;
      --red:#ff2b6a;
      --purple:#b46bff;

      --radius:16px;
      --mono: ui-monospace, Consolas, "Courier New", monospace;
      --ui: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:linear-gradient(180deg,#040812,#050a14);
      color:var(--text);
      font-family:var(--ui);
      padding:18px;
    }

    .wrap{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1.1fr 0.9fr;gap:14px}
    @media (max-width: 980px){ .wrap{grid-template-columns:1fr} }

    .card{
      background:linear-gradient(180deg,rgba(10,17,34,0.92),rgba(8,16,34,0.92));
      border:1px solid rgba(0,243,255,0.18);
      border-radius:var(--radius);
      box-shadow:0 12px 30px rgba(0,0,0,0.35);
      overflow:hidden;
    }

    .head{
      padding:12px 14px;
      border-bottom:1px solid rgba(0,243,255,0.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .title{
      margin:0;
      font-size:14px;
      font-weight:800;
      letter-spacing:0.5px;
    }

    .badge{
      font-family:var(--mono);
      font-size:11px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(0,243,255,0.10);
      border:1px solid rgba(0,243,255,0.18);
      color:var(--text);
      white-space:nowrap;
    }

    .body{padding:14px}

    .label{
      font-size:12px;
      color:var(--muted);
      font-weight:800;
      letter-spacing:0.4px;
      margin:0 0 8px 0;
    }

    textarea{
      width:100%;
      resize:vertical;
      border-radius:14px;
      border:1px solid rgba(0,243,255,0.18);
      background:rgba(6,10,22,0.75);
      color:var(--text);
      padding:12px;
      font-family:var(--mono);
      font-size:13px;
      line-height:1.45;
      outline:none;
    }

    #code{min-height:420px}
    #stdin{min-height:92px}

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }

    button{
      border-radius:12px;
      border:1px solid rgba(0,243,255,0.18);
      background:rgba(8,14,30,0.7);
      color:var(--text);
      padding:10px 12px;
      font-weight:800;
      cursor:pointer;
      transition: transform 0.05s ease, background 0.2s ease, border-color 0.2s ease;
    }
    button:active{ transform: translateY(1px); }

    .btn-run{ border-color: rgba(0,255,122,0.35); background: rgba(0,255,122,0.10); }
    .btn-run:hover{ background: rgba(0,255,122,0.16); }

    .btn-ghost{ background: rgba(0,243,255,0.06); }
    .btn-ghost:hover{ background: rgba(0,243,255,0.10); }

    .btn-danger{ border-color: rgba(255,43,106,0.35); background: rgba(255,43,106,0.10); }
    .btn-danger:hover{ background: rgba(255,43,106,0.16); }

    .console{
      background:rgba(0,0,0,0.35);
      border:1px solid rgba(0,243,255,0.14);
      border-radius:14px;
      padding:12px;
      font-family:var(--mono);
      font-size:12.5px;
      min-height:560px;
      white-space:pre-wrap; /* IMPORTANT for line breaks */
      overflow:auto;
    }
    @media (max-width: 980px){ .console{min-height:360px} }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- LEFT -->
    <div class="card">
      <div class="head">
        <div class="title">Python Sandbox</div>
        <div class="badge" id="status">Loading…</div>
      </div>

      <div class="body">
        <div class="label">CODE</div>
        <textarea id="code" spellcheck="false"></textarea>

        <div class="label" style="margin-top:12px;">INPUT</div>
        <textarea id="stdin" spellcheck="false"></textarea>

        <div class="row">
          <button class="btn-run" id="run">RUN</button>
          <button class="btn-ghost" id="clearOut">CLEAR OUTPUT</button>
          <button class="btn-ghost" id="reset">RESET</button>
          <button class="btn-danger" id="panic" title="Reload sandbox">PANIC</button>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="card">
      <div class="head">
        <div class="title">OUTPUT</div>
        <div class="badge">stdout / stderr</div>
      </div>

      <div class="body">
        <div id="console" class="console"></div>
      </div>
    </div>

  </div>

<script>
  const codeEl = document.getElementById("code");
  const stdinEl = document.getElementById("stdin");
  const consoleEl = document.getElementById("console");
  const statusEl = document.getElementById("status");
  const runBtn = document.getElementById("run");

  const DEFAULT_CODE = `print("Hello, world!")`;
  const DEFAULT_IN = ``;

  let pyodideReady = null;

  function setConsole(t){ consoleEl.textContent = t; consoleEl.scrollTop = consoleEl.scrollHeight; }
  function appendConsole(t){ consoleEl.textContent += t; consoleEl.scrollTop = consoleEl.scrollHeight; }

  async function boot(){
    setConsole("");
    statusEl.textContent = "Loading…";
    pyodideReady = loadPyodide();
    const py = await pyodideReady;

    py.setStdout({ batched: (s) => appendConsole(s) });
    py.setStderr({ batched: (s) => appendConsole(s) });

    statusEl.textContent = "Ready ✓";
  }

  runBtn.addEventListener("click", async () => {
    // always clear output each run
    setConsole("");

    // grab input, then CLEAR the box immediately (your requirement)
    const rawInput = stdinEl.value;
    stdinEl.value = "";

    // clean smart quotes
    const cleanedCode = codeEl.value
      .replace(/[“”]/g, '"')
      .replace(/[‘’]/g, "'");

    // parse stdin lines (one per input())
    const raw = rawInput.replace(/\r/g, "");
    const lines = raw.length ? raw.split("\n") : [];
    const jsLines = JSON.stringify(lines);

    // disable run while executing (prevents double-runs)
    runBtn.disabled = true;
    statusEl.textContent = "Running…";

    try{
      const py = await pyodideReady;

      // Patch input() AND force print() to always end with newline
      await py.runPythonAsync(`
import builtins

# Keep a reference to the original print (so prompts can stay inline)
_orig_print = builtins.print

_stdin_lines = ${jsLines}
_stdin_i = 0

def _stdin_input(prompt=""):
    global _stdin_i
    # show prompt inline
    if prompt:
        _orig_print(prompt, end="")
    # consume next line
    if _stdin_i < len(_stdin_lines):
        s = _stdin_lines[_stdin_i]
        _stdin_i += 1
        # echo the typed input + newline (so output looks like a real console)
        _orig_print(s)
        return s
    _orig_print("")
    return ""

def _println(*args, **kwargs):
    # Force newline always (println behaviour)
    # Ignore any custom 'end' from user code
    if "end" in kwargs:
        kwargs.pop("end", None)
    _orig_print(*args, end="\\n", **kwargs)

builtins.input = _stdin_input
builtins.print = _println
`);

      await py.runPythonAsync(cleanedCode);

      statusEl.textContent = "Done ✓";
    }catch(err){
      appendConsole(String(err));
      statusEl.textContent = "Error";
    }finally{
      runBtn.disabled = false;
      // after a short moment, return badge to Ready
      setTimeout(() => { statusEl.textContent = "Ready ✓"; }, 700);
    }
  });

  document.getElementById("clearOut").addEventListener("click", () => setConsole(""));

  document.getElementById("reset").addEventListener("click", () => {
    codeEl.value = DEFAULT_CODE;
    stdinEl.value = DEFAULT_IN;
    setConsole("");
  });

  document.getElementById("panic").addEventListener("click", () => location.reload());

  // start
  codeEl.value = DEFAULT_CODE;
  stdinEl.value = DEFAULT_IN;
  boot();
</script>
</body>
</html>
